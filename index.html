<script type="module">
  import { createClient } from 'https://esm.sh/@supabase/supabase-js'

  const supabase = createClient(
    'https://iwnnwqbtmpeqhdysoewk.supabase.co',
    'eyJhbGciOiJI...Dzw' // Twój anonKey
  );

  // 🔐 Zainicjuj sesję z URL (access_token)
  const { error: sessionError } = await supabase.auth.getSessionFromUrl();
  if (sessionError) {
    document.getElementById('message').textContent =
      'Błąd sesji: ' + sessionError.message;
  }

  document.getElementById('reset-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const password = document.getElementById('new-password').value;

    // 🔄 Zaktualizuj hasło
    const { error } = await supabase.auth.updateUser({ password });
    const msg = document.getElementById('message');

    if (error) {
      msg.textContent = 'Błąd przy zmianie hasła: ' + error.message;
      msg.style.color = 'red';
    } else {
      msg.textContent = 'Hasło zostało pomyślnie zmienione 🎉';
      msg.style.color = 'green';
    }
  });
</script>
